import { Dict } from 'i18n-js';
import I18n from '../I18n';

const INVALIDATION_TIME = 1000 * 60 * 60; // 1 hour

function getOutdatedTimestampKeys(timestamps: Dict): string[] {
  const allTimestampsKeys = Object.keys(timestamps);
  const currentTime = Date.now();

  return allTimestampsKeys.filter((key) => {
    // eslint-disable-next-line radix
    const timestamp = parseInt(timestamps[key]);
    return timestamp + INVALIDATION_TIME < currentTime;
  });
}

export default function invalidateTranslations(i18n: I18n) {
  const timestamps: Dict = i18n.storage.timestamps();
  const outdatedTimestampKeys = getOutdatedTimestampKeys(timestamps);

  i18n.removeTranslationsForTimestampKeys(outdatedTimestampKeys);
  i18n.storage.removeTimestampsForTimestampKeys(outdatedTimestampKeys);
}
